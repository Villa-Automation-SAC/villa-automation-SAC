<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mission: Enviar a Marte ‚Äî Juego</title>
<style>
  :root{ --accent:#00eaff; --panel:rgba(0,0,0,0.55); }
  body{ margin:0; background: radial-gradient(ellipse at bottom left,#001020 0%, #000814 60%); font-family:Inter,Arial,sans-serif; color:#e6f6ff; overflow:hidden; }
  canvas{ display:block; width:100vw; height:100vh; }
  .hud{ position:fixed; left:14px; top:12px; z-index:999; background:var(--panel); padding:10px 12px; border-radius:10px; color:#bfeaff; box-shadow:0 6px 20px rgba(0,0,0,0.6); }
  .hud .line{ font-size:14px; margin:4px 0; }
  .controlsUI{ position:fixed; right:14px; top:12px; z-index:999; background:var(--panel); padding:10px 12px; border-radius:10px; color:#bfeaff; box-shadow:0 6px 20px rgba(0,0,0,0.6); }
  #centerBox{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:999; background:rgba(0,0,0,0.75); padding:18px; border-radius:12px; text-align:center; display:none; width:320px; }
  .btn{ display:inline-block; background:var(--accent); color:#042b34; padding:10px 14px; border-radius:10px; font-weight:800; text-decoration:none; margin:8px; cursor:pointer; }
  /* Mobile touch controls */
  .touchPad{ position:fixed; left:12px; bottom:18px; z-index:998; display:flex; gap:8px; }
  .touchBtn{ width:64px; height:64px; border-radius:12px; background:rgba(255,255,255,0.04); display:grid; place-items:center; color:#dff6ff; font-weight:700; box-shadow:0 6px 18px rgba(0,0,0,0.6); }
  .touchRight{ position:fixed; right:12px; bottom:18px; display:flex; gap:8px; z-index:998; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div class="hud" id="hud">
  <div class="line">üöÄ Misi√≥n: Enviar a Marte</div>
  <div class="line">Fuel: <span id="fuel">100</span>%  ‚Ä¢ Vida: <span id="life">100</span>%</div>
  <div class="line">Puntuaci√≥n: <span id="score">0</span></div>
</div>

<div class="controlsUI">
  <div style="font-weight:700; margin-bottom:6px">Controles</div>
  <div style="font-size:13px">W/‚Üë A/‚Üê S/‚Üì D/‚Üí ‚Ä¢ SHIFT=Turbo ‚Ä¢ SPACE=Motor ‚Ä¢ CTRL=Freno</div>
  <div style="margin-top:8px"><a class="btn" id="restartBtn">Reiniciar</a> <a class="btn" id="backBtn" href="index.html">Volver</a></div>
</div>

<div id="centerBox">
  <div id="centerText" style="font-size:18px; margin-bottom:8px"></div>
  <div>
    <a class="btn" id="startBtn">Iniciar Misi√≥n</a>
    <a class="btn" id="resumeBtn" style="display:none">Reanudar</a>
  </div>
</div>

<!-- Mobile touch controls -->
<div class="touchPad" id="touchPad">
  <div class="touchBtn" data-key="ArrowLeft">‚óÄ</div>
  <div class="touchBtn" data-key="ArrowDown">‚ñº</div>
  <div class="touchBtn" data-key="ArrowUp">‚ñ≤</div>
  <div class="touchBtn" data-key="ArrowRight">‚ñ∂</div>
</div>
<div class="touchRight">
  <div class="touchBtn" data-key=" " title="Motor">‚éµ</div>
  <div class="touchBtn" data-key="Shift">‚áß</div>
</div>

<script>
// --- CONFIGURACI√ìN PARA MOSTRAR MARTE POR PUNTAJE ---
let showMars = false;            // Marte oculto al inicio
let puntosParaMarte = 1000;      // Cambia el puntaje necesario

/* -----------------------
   Juego: Mission a Marte
   - A√±ad√≠ un propulsor visual (flama + part√≠culas) sin alterar la estructura HTML
   - Cambios concentrados en la secci√≥n <script>
   ------------------------*/

// canvas
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
});

// imagen cohete (SVG embebido)
const imgCohete = new Image();
imgCohete.src = "assets/cohete4.png"; + encodeURIComponent(`
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 220'>
 <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='#00eaff'/><stop offset='1' stop-color='#0073b8'/></linearGradient></defs>
 <rect width='120' height='220' rx='18' fill='none'/>
 <g transform='translate(10,10)'>
   <path d='M50 0 L90 80 Q60 120 50 200 Q40 120 10 80 Z' fill='url(#g)' stroke='#002' stroke-width='2'/>
   <circle cx='50' cy='70' r='12' fill='#fff'/>
   <rect x='35' y='195' width='30' height='10' rx='5' fill='#ff8c2b'/>
 </g>
</svg>
`);

// estado
let cohete;
let meteoros = [];
let satelites = [];
let score = 0;
let fuel = 100;
let life = 100;
let gameOver = false;
let running = false;
let keys = {};
let spawnIntervals = [];

// NEW: propulsor / part√≠culas
let exhaustParticles = [];
function spawnExhaust(x, y, strength){
  // strength: 0..1
  const count = Math.max(2, Math.floor(6 * strength));
  for(let i=0;i<count;i++){
    const ang = (Math.PI/2) + (Math.random()-0.5) * 0.6; // spread downward
    const speed = 1.2 + Math.random()*2.2 + strength*3.0;
    exhaustParticles.push({
      x: x + (Math.random()-0.5)*10,
      y: y + (Math.random()-0.5)*8,
      vx: Math.cos(ang) * (speed * (0.3 + Math.random()*0.8)),
      vy: Math.sin(ang) * (speed * (0.6 + Math.random()*1.2)),
      life: 0.45 + Math.random()*0.6,
      age: 0,
      size: 6 + Math.random()*10,
      hue: 30 + Math.random()*40
    });
  }
}
function updateExhaust(dt){
  for(let i=exhaustParticles.length-1;i>=0;i--){
    const p = exhaustParticles[i];
    p.age += dt;
    p.x += p.vx * dt * 60;
    p.y += p.vy * dt * 60;
    // apply slight drag and upward buoyancy (to simulate flame streaming)
    p.vx *= 0.985;
    p.vy *= 0.992;
    if(p.age >= p.life) exhaustParticles.splice(i,1);
  }
}

// audio (opcional)
let audioCtx = null;
function ensureAudio(){ if(!audioCtx){ try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){ audioCtx=null; } } }

// controles teclado
window.addEventListener('keydown', e => { keys[e.key] = true; if(!running && e.key==='Enter') startMission(); if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); });
window.addEventListener('keyup', e => { keys[e.key] = false; });

// touch buttons set keys on pointer events
document.querySelectorAll('.touchBtn').forEach(btn=>{
  btn.addEventListener('pointerdown', (ev)=> { const k=btn.dataset.key; keys[k]=true; btn.style.transform='scale(0.96)'; });
  btn.addEventListener('pointerup', ()=> { const k=btn.dataset.key; keys[k]=false; btn.style.transform=''; });
  btn.addEventListener('pointerleave', ()=> { const k=btn.dataset.key; keys[k]=false; btn.style.transform=''; });
});

// HUD elements
const fuelEl = document.getElementById('fuel');
const lifeEl = document.getElementById('life');
const scoreEl = document.getElementById('score');
const centerBox = document.getElementById('centerBox');
const centerText = document.getElementById('centerText');
const startBtn = document.getElementById('startBtn');
const resumeBtn = document.getElementById('resumeBtn');
const restartBtn = document.getElementById('restartBtn');
const backBtn = document.getElementById('backBtn');

startBtn.addEventListener('click', startMission);
restartBtn.addEventListener('click', ()=>{ resetAndStart(); });
resumeBtn.addEventListener('click', ()=>{ running=true; centerBox.style.display='none'; loop(); });

// crear cohete
function crearCohete(){
  return {
    x: W*0.5 - 30,
    y: H - 180,
    w: 60,
    h: 110,
    vx: 0,
    vy: 0,
    angle: -Math.PI/2, // hacia arriba
    thrust: 0.16
  };
}

// generadores
function generarMeteorito(){
  meteoros.push({
    x: Math.random()*W,
    y: -60,
    r: 18 + Math.random()*28,
    vx: (Math.random()-0.5)*0.6,
    vy: 2 + Math.random()*3
  });
}
function generarSatelite(){
  satelites.push({
    x: Math.random()*W,
    y: -80,
    w: 64,
    h: 28,
    vy: 1.5 + Math.random()
  });
}

// limpiar intervals
function clearSpawnIntervals(){
  spawnIntervals.forEach(i=>clearInterval(i));
  spawnIntervals = [];
}

// start/reset
function resetAndStart(){
  clearSpawnIntervals();
  meteoros = [];
  satelites = [];
  score = 0;
  fuel = 100;
  life = 100;
  gameOver = false;
  running = false;
  centerBox.style.display='block';
  centerText.innerText = 'Preparando misi√≥n‚Ä¶';
  resumeBtn.style.display='none';
  startBtn.style.display='inline-block';
  fuelEl.innerText = Math.floor(fuel);
  lifeEl.innerText = Math.floor(life);
  scoreEl.innerText = score;
  cohete = crearCohete();
}
function startMission(){
  if(running) return;
  ensureAudio();
  centerBox.style.display='none';
  running = true;
  gameOver = false;
  cohete = crearCohete();
  meteoros = [];
  satelites = [];
  score = 0;
  fuel = 100;
  life = 100;
  fuelEl.innerText = Math.floor(fuel);
  lifeEl.innerText = Math.floor(life);
  scoreEl.innerText = score;

  // spawn
  spawnIntervals.push(setInterval(generarMeteorito, 900));
  spawnIntervals.push(setInterval(generarSatelite, 2200));
  loop();
}

// colisiones
function rectCircleCollision(rect, circ){
  const dx = Math.max(rect.x, Math.min(circ.x, rect.x + rect.w));
  const dy = Math.max(rect.y, Math.min(circ.y, rect.y + rect.h));
  const dist = Math.hypot(circ.x - dx, circ.y - dy);
  return dist < circ.r;
}
function rectRectCollision(a,b){
  return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
}

// efectos de sonido simples
let engineOsc=null, engineGain=null;
function playEngine(on){
  if(!audioCtx) return;
  if(on){
    if(!engineOsc){
      engineOsc = audioCtx.createOscillator();
      engineOsc.type = 'sawtooth';
      engineOsc.frequency.value = 80;
      engineGain = audioCtx.createGain();
      engineGain.gain.value = 0;
      engineOsc.connect(engineGain);
      engineGain.connect(audioCtx.destination);
      engineOsc.start();
    }
    engineGain.gain.exponentialRampToValueAtTime(0.02, audioCtx.currentTime+0.05);
    engineOsc.frequency.setTargetAtTime(120 + (cohete.thrust*200), audioCtx.currentTime, 0.1);
  } else {
    if(engineGain) engineGain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.1);
  }
}

// dibujo
function draw(){
  // background: subtle gradient + stars
  ctx.fillStyle = '#000812';
  ctx.fillRect(0,0,W,H);

  // stars
  for(let i=0;i<60;i++){
    ctx.fillStyle = 'rgba(255,255,255,'+ (Math.random()*0.25+0.05) +')';
    ctx.fillRect(Math.random()*W, Math.random()*H, Math.random()*1.8, Math.random()*1.8);

    // Marte aparece solo cuando est√° activado
if (showMars) {
    ctx.beginPath();
    ctx.fillStyle = "#c1440e";   // color tipo Marte
    ctx.arc(W * 0.85, H * 0.18, 60, 0, Math.PI * 2);
    ctx.fill();
}

  }

  // trajectory guide (distant)
  ctx.beginPath();
  ctx.strokeStyle = 'rgba(255,200,120,0.06)';
  ctx.lineWidth = 4;
  ctx.moveTo(W*0.12, H*0.85);
  ctx.quadraticCurveTo(W*0.5, H*0.18, W*0.88, H*0.55);
  ctx.stroke();

  // draw meteoros
  meteoros.forEach(m=>{
    ctx.fillStyle = 'rgba(220,160,90,0.98)';
    ctx.beginPath();
    ctx.arc(m.x, m.y, m.r, 0, Math.PI*2);
    ctx.fill();
    // tail
    ctx.strokeStyle = 'rgba(220,160,90,0.25)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(m.x - m.vx*10, m.y - m.vy*10);
    ctx.lineTo(m.x, m.y);
    ctx.stroke();
  });

  // satellites
  satelites.forEach(s=>{
    ctx.save();
    ctx.translate(s.x, s.y);
    ctx.fillStyle = 'rgba(200,220,255,0.95)';
    ctx.fillRect(-s.w/2, -s.h/2, s.w, s.h);
    ctx.fillStyle='rgba(120,150,180,0.95)';
    ctx.fillRect(-s.w/2 - 16, -s.h/2 + 6, 16, s.h-12);
    ctx.fillRect(s.w/2, -s.h/2 + 6, 16, s.h-12);
    ctx.restore();
  });

  // NEW: draw exhaust particles behind rocket
  ctx.save();
  ctx.globalCompositeOperation = 'lighter';
  for(let i=exhaustParticles.length-1;i>=0;i--){
    const p = exhaustParticles[i];
    const alpha = Math.max(0, 1 - (p.age / p.life));
    const s = p.size * (0.4 + 0.6 * (1 - p.age / p.life));
    // outer glow
    ctx.beginPath();
    const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, s*1.4);
    grad.addColorStop(0, `rgba(255,${180 - (p.hue%60)},0,${alpha*0.7})`);
    grad.addColorStop(0.5, `rgba(255,140,40,${alpha*0.5})`);
    grad.addColorStop(1, `rgba(120,40,10,${alpha*0.02})`);
    ctx.fillStyle = grad;
    ctx.arc(p.x, p.y, s*1.4, 0, Math.PI*2);
    ctx.fill();
    // core
    ctx.beginPath();
    ctx.fillStyle = `rgba(255,255,200,${alpha})`;
    ctx.arc(p.x, p.y, s*0.6, 0, Math.PI*2);
    ctx.fill();
  }
  ctx.restore();

  // draw rocket image (centered at cohete.x, cohete.y)
  if(imgCohete.complete){
    ctx.drawImage(imgCohete, cohete.x, cohete.y, cohete.w, cohete.h);
  } else {
    // fallback: simple triangle
    ctx.fillStyle = '#00eaff';
    ctx.beginPath();
    ctx.moveTo(cohete.x + cohete.w/2, cohete.y);
    ctx.lineTo(cohete.x, cohete.y + cohete.h);
    ctx.lineTo(cohete.x + cohete.w, cohete.y + cohete.h);
    ctx.closePath();
    ctx.fill();
  }

  // HUD is DOM-based (no draw)
}

// game logic / physics loop
let last = performance.now();
function loop(now){
  if(!running) return;
  const t = now || performance.now();
  let dt = (t - last) / 1000;
  if(dt > 0.05) dt = 0.05;
  last = t;
  
   // Activar Marte cuando sube lo suficiente y tiene el puntaje requerido
if (!showMars && score >= puntosParaMarte && cohete.y < H * 0.20) {
    showMars = true;
}
  // controls: rotation & thrust simplified (we keep cohete angle fixed vertically for simplicity)
  // thrust actions
  const thrusting = keys['ArrowUp'] || keys['w'] || keys[' '];
  const turbo = keys['Shift'];
  const brake = keys['Control'];
  if(thrusting && fuel > 0){
    const p = cohete.thrust * (turbo?2.2:1.0);
    cohete.vy -= p * dt * 60;
    fuel = Math.max(0, fuel - 0.08 * (turbo?2.5:1) * dt * 60);
    // spawn exhaust particles at nozzle position (bottom-center)
    const nozzleX = cohete.x + cohete.w/2;
    const nozzleY = cohete.y + cohete.h + 6; // slightly below rocket image
    spawnExhaust(nozzleX, nozzleY, Math.min(1, p*3));

  }
  if(keys['ArrowLeft'] || keys['a']) cohete.vx -= 0.16 * dt * 60;
  if(keys['ArrowRight'] || keys['d']) cohete.vx += 0.16 * dt * 60;
  if(keys['ArrowDown'] || keys['s']) cohete.vy += 0.14 * dt * 60;
  if(brake){ cohete.vx *= 0.96; cohete.vy *= 0.96; }

  // physics
  cohete.vx *= 0.995;
  cohete.vy *= 0.995;
  cohete.vy += 0.018 * dt * 60; // mild gravity
  cohete.x += cohete.vx * dt * 60;
  cohete.y += cohete.vy * dt * 60;

  // update objects
  meteoros.forEach(m=>{
    m.x += (m.vx) * dt * 60;
    m.y += m.vy * dt * 60;
  });
  satelites.forEach(s=>{
    s.y += s.vy * dt * 60;
    s.x += Math.sin(t/600 + s.x*0.001)*0.6;
  });

  // update exhaust
  updateExhaust(dt);

  // collisions
  meteoros.forEach((m, i)=>{
    if(rectCircleCollision({x:cohete.x, y:cohete.y, w:cohete.w, h:cohete.h}, m)){
      // hit
      life = Math.max(0, life - (8 + Math.random()*10));
      score = Math.max(0, score - 20);
      // remove meteor (push below)
      m.y = H + 200;
    }
  });
  satelites.forEach((s,i)=>{
    if(rectRectCollision({x:cohete.x, y:cohete.y, w:cohete.w, h:cohete.h}, {x:s.x - s.w/2, y:s.y - s.h/2, w:s.w, h:s.h})){
      life = Math.max(0, life - 22);
      score = Math.max(0, score - 40);
      s.y = H + 200;
    }
  });

  // cleanup offscreen
  meteoros = meteoros.filter(m => m.y < H + 150);
  satelites = satelites.filter(s => s.y < H + 200);

  // update values
  score += Math.floor(1 + (thrusting?2:0));
  fuelEl.innerText = Math.max(0, Math.floor(fuel));
  lifeEl.innerText = Math.max(0, Math.floor(life));
  scoreEl.innerText = Math.floor(score);

  // engine sound
  if(thrusting){ ensureAudio(); playEngine(true); } else { playEngine(false); }

  // fail / success
  if(life <= 0 && !gameOver){
    gameOver = true;
    running = false;
    centerText.innerHTML = 'üí• NAVE DESTRUIDA';
    centerBox.style.display = 'block';
    resumeBtn.style.display = 'none';
    startBtn.style.display = 'inline-block';
    clearSpawnIntervals();
  }
  // success condition: reach top-right sector near Mars target
 if (showMars) {
    const dx = (cohete.x + cohete.w/2) - (W*0.85);
    const dy = (cohete.y + cohete.h/2) - (H*0.18);

    if (Math.hypot(dx, dy) < 80 && !gameOver) {
        gameOver = true;
        running = false;
        centerText.innerHTML = 'üèÅ ¬°√âXITO! Llegaste a Marte';
        centerBox.style.display = 'block';
        resumeBtn.style.display = 'none';
        startBtn.style.display = 'inline-block';
        clearSpawnIntervals();
    }
}


  // draw on every frame
  draw();
  if(running) requestAnimationFrame(loop);
}

// init/reset
resetAndStart(); // initial state shows center box
// auto-start when clicking Start
// bind start button already

// event: back link
backBtn.addEventListener('click', ()=>{ /* returns to index */ });

// ensure spawn intervals set only once per start
// We added intervals when startMission() is called and we clear them on reset.

// safety: prevent multiple intervals if user presses start many times
// intervals are stored in spawnIntervals[] and cleared in clearSpawnIntervals().
let showMars = false;
let puntosParaMarte = 1000;

</script>
</body>
</html>







