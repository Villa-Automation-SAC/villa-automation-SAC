<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Misión a Marte</title>
<style>
    body {
        margin: 0;
        background: #000;
        font-family: Arial;
        overflow: hidden;
        color: white;
    }

    #hud {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 20px;
        color: #00eaff;
        text-shadow: 0 0 10px #00eaff;
    }

    #messageBox {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 32px;
        background: rgba(0,0,0,0.6);
        padding: 20px 35px;
        border-radius: 12px;
        text-align: center;
        display: none;
    }

    #restartBtn {
        margin-top: 12px;
        padding: 10px 20px;
        border: none;
        background: #00c3ff;
        color: white;
        font-size: 22px;
        cursor: pointer;
        border-radius: 10px;
    }

    #restartBtn:hover {
        background: #008ecc;
    }
</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="hud">
    Vida: <span id="vidas">3</span> <br>
    Puntuación: <span id="score">0</span>
</div>

<div id="messageBox">
    <span id="msgText"></span><br>
    <button id="restartBtn">Reiniciar</button>
</div>

<script>
// ==================== VARIABLES DEL JUEGO ======================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let cohete;
let meteoros = [];
let satelites = [];
let vidas = 3;
let score = 0;
let gameOver = false;
let keys = {};

const audioContext = new (window.AudioContext || window.webkitAudioContext)();

// ==================== CONTROL DE TECLAS ======================
document.addEventListener("keydown", e => { keys[e.key] = true; });
document.addEventListener("keyup", e => { keys[e.key] = false; });

// ==================== OBJETO COHETE ======================
function crearCohete() {
    return {
        x: canvas.width/2,
        y: canvas.height - 120,
        w: 40,
        h: 60,
        velY: 0
    };
}

// ==================== DIBUJOS ======================
function dibujarCohete() {
    ctx.fillStyle = "#00eaff";
    ctx.fillRect(cohete.x, cohete.y, cohete.w, cohete.h);

    ctx.fillStyle = "orange";
    ctx.fillRect(cohete.x + 10, cohete.y + cohete.h, 20, 20);
}

function dibujarMeteorito(m) {
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(m.x, m.y, m.r, 0, Math.PI*2);
    ctx.fill();
}

function dibujarSatelite(s) {
    ctx.fillStyle = "silver";
    ctx.fillRect(s.x, s.y, s.w, s.h);
}

// ==================== GENERADORES ======================
function generarMeteorito() {
    meteoros.push({
        x: Math.random() * canvas.width,
        y: -50,
        r: 30 + Math.random()*20,
        vel: 2 + Math.random()*3
    });
}

function generarSatelite() {
    satelites.push({
        x: Math.random() * canvas.width,
        y: -60,
        w: 60,
        h: 30,
        vel: 1.5
    });
}

// ==================== COLISIONES ======================
function colisionRectCir(rect, cir) {
    const dx = Math.max(rect.x, Math.min(cir.x, rect.x + rect.w));
    const dy = Math.max(rect.y, Math.min(cir.y, rect.y + rect.h));
    const dist = Math.sqrt((cir.x - dx)**2 + (cir.y - dy)**2);
    return dist < cir.r;
}

function colisionRectRect(a, b) {
    return !(a.x + a.w < b.x ||
             a.x > b.x + b.w ||
             a.y + a.h < b.y ||
             a.y > b.y + b.h);
}

// ==================== LOOP DEL JUEGO ======================
function update() {
    if (gameOver) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Cohete controla altura
    if (keys["ArrowUp"]) cohete.velY -= 0.2;
    cohete.velY *= 0.98;
    cohete.y += cohete.velY;

    // No salir del mapa
    if (cohete.y < 50) cohete.y = 50;
    if (cohete.y > canvas.height - 150) cohete.y = canvas.height - 150;

    // Dibuja cohete
    dibujarCohete();

    // ================= METEORITOS =================
    meteoros.forEach((m, i) => {
        m.y += m.vel;
        dibujarMeteorito(m);

        if (colisionRectCir(cohete, m)) daño();
        if (m.y > canvas.height+50) {
            meteoros.splice(i,1);
            score += 5;
        }
    });

    // ================= SATÉLITES =================
    satelites.forEach((s, i) => {
        s.y += s.vel;
        dibujarSatelite(s);

        if (colisionRectRect(cohete, s)) daño();
        if (s.y > canvas.height+60) {
            satelites.splice(i,1);
            score += 10;
        }
    });

    document.getElementById("score").innerText = score;

    // Objetivo: llegar arriba → Marte
    if (cohete.y <= 50) {
        victoria();
        return;
    }

    requestAnimationFrame(update);
}

// ==================== DAÑO ======================
function daño() {
    vidas--;
    document.getElementById("vidas").innerText = vidas;

    if (vidas <= 0) {
        mostrarMensaje("NAVE DESTRUIDA<br>Reinicia");
        gameOver = true;
    }
}

// ==================== VICTORIA ======================
function victoria() {
    mostrarMensaje("¡ÉXITO!<br>Llegaste a Marte");
    gameOver = true;
}

// ==================== MENSAJES ======================
function mostrarMensaje(txt) {
    document.getElementById("msgText").innerHTML = txt;
    document.getElementById("messageBox").style.display = "block";
}

// ==================== REINICIO ======================
function init() {
    vidas = 3;
    score = 0;
    cohete = crearCohete();
    meteoros = [];
    satelites = [];
    gameOver = false;

    document.getElementById("vidas").innerText = vidas;
    document.getElementById("score").innerText = score;
    document.getElementById("messageBox").style.display = "none";

    // generadores constantes
    setInterval(generarMeteorito, 1200);
    setInterval(generarSatelite, 2500);

    update();
}

document.getElementById("restartBtn").addEventListener("click", init);

// Iniciar juego
init();
</script>

</body>
</html>
