<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Misi√≥n a Marte</title>
<style>
    body {
        margin: 0;
        background: #000;
        font-family: Arial;
        overflow: hidden;
        color: white;
    }

    #hud {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 20px;
        color: #00eaff;
        text-shadow: 0 0 10px #00eaff;
        z-index: 1000;
    }

    #messageBox {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 32px;
        background: rgba(0,0,0,0.7);
        padding: 20px 35px;
        border-radius: 12px;
        text-align: center;
        display: none;
        z-index: 1000;
    }

    .btn {
        margin-top: 12px;
        padding: 12px 30px;
        border: none;
        background: #00c3ff;
        color: white;
        font-size: 22px;
        cursor: pointer;
        border-radius: 10px;
        transition: 0.3s;
    }

    .btn:hover {
        background: #008ecc;
        transform: scale(1.05);
    }

</style>
</head>

<body>
<canvas id="game"></canvas>

<div id="hud">
    üöÄ Vida: <span id="vidas">5</span><br>
    ‚≠ê Puntuaci√≥n: <span id="score">0</span>
</div>

<div id="messageBox">
    <span id="msgText"></span><br>
    <button id="restartBtn" class="btn">Reiniciar</button>
</div>

<script>
// ==================== VARIABLES ======================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let cohete;
let meteoros = [];
let satelites = [];
let vidas = 5;
let score = 0;
let gameOver = false;
let keys = {};

// ==================== EVENTOS TECLADO ======================
document.addEventListener("keydown", e => (keys[e.key] = true));
document.addEventListener("keyup", e => (keys[e.key] = false));

// ==================== CREAR COHETE ======================
function crearCohete() {
    return {
        x: canvas.width / 2,
        y: canvas.height - 150,
        w: 50,
        h: 80,
        velX: 0,
        velY: 0
    };
}

// ==================== DIBUJAR COHETE ======================
function dibujarCohete() {
    // cuerpo
    ctx.fillStyle = "#00eaff";
    ctx.beginPath();
    ctx.moveTo(cohete.x + cohete.w / 2, cohete.y);
    ctx.lineTo(cohete.x, cohete.y + cohete.h);
    ctx.lineTo(cohete.x + cohete.w, cohete.y + cohete.h);
    ctx.closePath();
    ctx.fill();

    // ventana
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(cohete.x + cohete.w / 2, cohete.y + 35, 12, 0, Math.PI * 2);
    ctx.fill();

    // fuego
    ctx.fillStyle = "orange";
    ctx.beginPath();
    ctx.moveTo(cohete.x + 15, cohete.y + cohete.h);
    ctx.lineTo(cohete.x + cohete.w - 15, cohete.y + cohete.h);
    ctx.lineTo(cohete.x + cohete.w / 2, cohete.y + cohete.h + 30 + Math.random() * 10);
    ctx.closePath();
    ctx.fill();
}

// ==================== DIBUJAR OBJETOS ======================
function dibujarMeteorito(m) {
    ctx.fillStyle = "orange";
    ctx.beginPath();
    ctx.arc(m.x, m.y, m.r, 0, Math.PI * 2);
    ctx.fill();
}

function dibujarSatelite(s) {
    ctx.fillStyle = "gray";
    ctx.fillRect(s.x, s.y, s.w, s.h);
    ctx.fillStyle = "lightblue";
    ctx.fillRect(s.x - 20, s.y + 5, 20, s.h - 10);
    ctx.fillRect(s.x + s.w, s.y + 5, 20, s.h - 10);
}

// ==================== GENERADORES ======================
function generarMeteorito() {
    meteoros.push({
        x: Math.random() * canvas.width,
        y: -30,
        r: 25 + Math.random() * 25,
        vel: 2 + Math.random() * 2
    });
}

function generarSatelite() {
    satelites.push({
        x: Math.random() * canvas.width,
        y: -60,
        w: 40,
        h: 30,
        vel: 2
    });
}

// ==================== COLISIONES ======================
function colisionRectCir(rect, cir) {
    const dx = Math.max(rect.x, Math.min(cir.x, rect.x + rect.w));
    const dy = Math.max(rect.y, Math.min(cir.y, rect.y + rect.h));
    const distancia = Math.sqrt((cir.x - dx) ** 2 + (cir.y - dy) ** 2);
    return distancia < cir.r;
}

function colisionRectRect(a, b) {
    return !(
        a.x + a.w < b.x ||
        a.x > b.x + b.w ||
        a.y + a.h < b.y ||
        a.y > b.y + b.h
    );
}

// ==================== LOOP PRINCIPAL ======================
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    dibujarCohete();

    // meteoros
    meteoros.forEach(m => {
        m.y += m.vel;
        dibujarMeteorito(m);

        if (colisionRectCir(cohete, m)) {
            da√±o();
            m.y = canvas.height + 50;
        }
    });

    // sat√©lites
    satelites.forEach(s => {
        s.y += s.vel;
        dibujarSatelite(s);

        if (colisionRectRect(cohete, s)) {
            da√±o();
            s.y = canvas.height + 50;
        }
    });

    // puntaje
    if (!gameOver) {
        score++;
        document.getElementById("score").innerText = score;
    }

    // victoria
    if (score > 20000 && !gameOver) {
        victoria();
    }
}

function update() {

    // Controles del cohete
    if (keys["ArrowUp"] || keys["w"]) cohete.velY -= 0.25;
    if (keys["ArrowDown"] || keys["s"]) cohete.velY += 0.25;
    if (keys["ArrowLeft"] || keys["a"]) cohete.velX -= 0.25;
    if (keys["ArrowRight"] || keys["d"]) cohete.velX += 0.25;
    if (keys["Shift"]) cohete.velY -= 0.4;
    if (keys["Control"]) { cohete.velX *= 0.8; cohete.velY *= 0.8; }
    if (keys[" "]) cohete.velY -= 0.3;

    // F√çSICA
    cohete.velY *= 0.98;
    cohete.velX *= 0.98;

    cohete.x += cohete.velX;
    cohete.y += cohete.velY;

    cohete.velY += 0.05;

    // L√≠mites
    if (cohete.x < 0) cohete.x = 0;
    if (cohete.x + cohete.w > canvas.width) cohete.x = canvas.width - cohete.w;
    if (cohete.y < 0) cohete.y = 0;
    if (cohete.y + cohete.h > canvas.height) cohete.y = canvas.height - cohete.h;

    draw();

    if (!gameOver) requestAnimationFrame(update);
}

// ==================== DA√ëO ======================
function da√±o() {
    vidas--;
    document.getElementById("vidas").innerText = vidas;
    if (vidas <= 0) {
        mostrarMensaje("üí• NAVE DESTRUIDA");
        gameOver = true;
    }
}

// ==================== MENSAJES ======================
function mostrarMensaje(txt) {
    document.getElementById("msgText").innerHTML = txt;
    document.getElementById("messageBox").style.display = "block";
}

// ==================== REINICIAR ======================
function init() {
    vidas = 5;
    score = 0;
    cohete = crearCohete();
    meteoros = [];
    satelites = [];
    gameOver = false;

    document.getElementById("vidas").innerText = vidas;
    document.getElementById("score").innerText = score;
    document.getElementById("messageBox").style.display = "none";

    setInterval(generarMeteorito, 900);
    setInterval(generarSatelite, 2000);

    update();
}

document.getElementById("restartBtn").addEventListener("click", init);

// iniciar juego
init();

</script>
</body>
</html>

